{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Home","text":"<p>Welcome to the TMfS18 Trip End Model documentation. This documentation is  intended for a technical audience, and should be reviewed alongside the trip  end model itself.</p> <p>This site describes the functionality and operation of the Transport Model  for Scotland (TMfS18) Trip End Model. It describes the following aspects of  the model:</p> <ul> <li>Introduction</li> <li>Methodology</li> <li>User Guide</li> <li>Input and Output Files</li> <li>Programming Overview</li> </ul> <p>This code is provided as part of Transport Scotland's LATIS framework. For  more information, please visit the appropriate  page  on the Transport Scotland website.</p>"},{"location":"01_introduction.html","title":"Introduction","text":""},{"location":"01_introduction.html#overview","title":"Overview","text":"<p>The Trip End Model contains two main stages:</p> <p>Stage 1: Prepares the underlying car and public transport travel demand inputs for the TMfS demand model (i.e. trip ends). These trip ends include movements associated with airport zones. This stage of the Trip End Model is scripted in the Python programming language based on previous Visual Basic applications; and</p> <p>Stage 2: Prepares 'add in' matrices (using a Cube Voyager application), which are travel demand inputs used within the TMfS forecasting process, but not part of the core demand model. The Cube Voyager application uses inputs created from Stage 1 to generate education travel matrices, external trips (travel movements with an origin or destination located outside Scotland), and goods vehicle movements.</p>"},{"location":"01_introduction.html#trip-end-model-history","title":"Trip End Model History","text":"<p>This TMfS18 Trip End Model was developed based on previous versions developed and updated as part of TMfS. The Trip End Model was originally a spreadsheet type model developed for TMfS02. This process was updated during the development of TMfS05 to include goods vehicle matrix creation processes controlled by Visual Basic programming. The TMfS18 Trip End Model uses a combination of Python programming and Cube Voyager software.</p>"},{"location":"02_methodology.html","title":"Methodology","text":""},{"location":"02_methodology.html#overview","title":"Overview","text":"<p>The Trip End Model is an incremental model which pivots from files prepared as part of the TMfS18 base year model. Therefore, the relevant base year files must be accessible to operate the Trip End Model before a new run of the Trip End Model can be undertaken.</p> <p>Using this methodology, the trip end model acts entirely as a ratio model. Growth rates for each modelled zone are calculated using a combination of changes in planning data (number of households, population and employment forecast over time) and a series of trip rates. These rates of growth are then applied to TMfS base year trip ends to create forecast year trip ends.</p>"},{"location":"02_methodology.html#data-sources","title":"Data Sources","text":"<p>The Trip End Model uses data from five main sources, namely:</p> <ul> <li>Trip rate data from the UK Department for Transport (DfT) National Trip End Model (NTEM);</li> <li>Output planning data from the Transport Economic Land-Use Model Of Scotland (TELMoS);</li> <li>DfT Road Traffic Forecasts (RTF);</li> <li>Rail growth factors, currently derived from TELMoS GVA forecasts; and</li> <li>Airport growth data, for example from DfT aviation forecasts.</li> </ul> <p>The use of these data sources in the trip end model are discussed in the  following sections.</p>"},{"location":"02_methodology.html#national-trip-end-model-ntem","title":"National Trip End Model (NTEM)","text":"<p>The trip rates provided within the National Trip End Model (NTEM) form an integral part of the DfT's National Transport Model (NTM) and TEMPRO. There are three main components of the NTEM model, which have been incorporated into the TMfS model, including:</p> <ol> <li>Household car ownership forecasting;</li> <li>A demographic model which allocates household and person type     planning data to a system of 88 person-type categories; and</li> <li>Calculation of trip ends by applying trip rates to the number of     persons in each of the 88 person-type categories</li> </ol> <p>The NTEM trip rate structure is disaggregate and they are applied on a zonal basis at the person trip making level within the trip end model. These NTEM trip rates are also used within the TMfS Trip End Model.</p> <p>The NTEM person type categories are split into a matrix of eleven person types and eight household types generating 88 categories in total.</p> <p>The eleven person types are:</p> <ul> <li>Children (0 to 15);</li> <li>males in full time employment (16 to 74);</li> <li>males in part time employment (16 to 74);</li> <li>male students (16 to 74);</li> <li>male not employed / students (16 to 74) - unemployed plus other inactive;</li> <li>male 75+;</li> <li>females in full time employment (16 to 74);</li> <li>females in part time employment (16 to 74);</li> <li>female students (16 to 74);</li> <li>female not employed / students (16 to 74) - unemployed plus other inactive; and</li> <li>female 75+.</li> </ul> <p>The eight household types are:</p> <ul> <li>1 adult household with no access to a Car;</li> <li>1 adult household with access to one or more Cars;</li> <li>2 adult households with no access to a Car;</li> <li>2 adult households with access to one Car;</li> <li>2 adult households with access to two or more Cars;</li> <li>3+ adult households with no access to a Car;</li> <li>3+ adult households with access to one Car; and</li> <li>3+ adult households with access to two or more Cars.</li> </ul> <p>The specific travel modes included in NTEM are:</p> <ul> <li>Walk;</li> <li>Cycle;</li> <li>Car driver;</li> <li>Car passenger;</li> <li>Bus; and</li> <li>Rail (including underground).</li> </ul> <p>Note that the walk and cycle modes are not included within the TMfS18 Trip End Model.</p> <p>Production trip rates for these 88 categories are obtained from the NTEM using the input databases to the <code>CTRIPEND</code> software1. The <code>IBETAhsr</code> table was used to provide the weekly trip rates by purpose, traveller type and area type. The table <code>IRHOmdshr</code> was used to split these trip rates by time period and mode.</p> <p>Note that for the purposes of TMfS18, and TMfS14, each zone is assigned a relevant NTEM \"Area Type\" in the <code>AreaCorrespondence.csv</code> input file. This replaces the previous method where \"Area Type 5\" (Urban Medium) was applied to all zones.</p> <p>Trip rates are stored within a single file containing columns for each segmentation available: purpose, mode, period, area type, traveller type, and commute category (Working at Home - WAH and Working by Commute - WBC).</p> <p>This file storage method is a change from previous versions of the Trip End Model, where separate files were used for each segmentation, and should increase maintainability and clarity if these values need to be altered in the future. The trip rate files are stored in the \"Factors\" folder in the files <code>TripRates.csv</code> and <code>TripRatesSplit.csv</code>, for the standard trip rates and the WAH/WBC split trip rates, respectively.</p> <p>The car driver and car passenger rates are combined to produce car person trip rates. Similarly, bus and rail trip rates are combined to produce general public transport trip rates.</p>"},{"location":"02_methodology.html#trip-rate-calculation","title":"Trip Rate Calculation","text":"<p>The relevant calculations applied for the trip rate for  AM Peak Car, for a Male in Full time Work, from a 3 adults with 2+ car household are illustrated below as an example of how these trip rates were calculated from the databases.</p> <ul> <li>The weekly trip rate for a Male in Full time Work from a 3 adults with   2+ car household (all modes, all week) is 4.081137 (from <code>IBETAshr</code>)</li> <li>The relevant mode splits for an (AM) Car Driver and an (AM) Car   Passenger are 0.541076 and 0.042546, respectively (from <code>IRHOmdhsr</code>).</li> <li>This creates a weekly AM car trip rate of \\(4.081137 * (0.541076 + 0.042546) = 2.38184\\)</li> <li>A similar calculation is carried out for the PT trip rates using the   bus and rail splits from <code>IRHOmdshr</code>.</li> </ul> <p>For the WAH/WBC segmentation, the same operation is carried out for each segment using the relevant trip rates.</p>"},{"location":"02_methodology.html#telmos-planning-data","title":"TELMoS Planning Data","text":"<p>To enable forecasting, the Trip End Model requires various planning data which describes how the number of households, population and employment located within each modelled zone may change over time. This data is used to create growth factors for each modelled zone between the base year and each forecast year scenario.</p> <p>The planning data input to the Trip End Model is provided by the TELMoS land\u2011use model. Examples of TELMoS outputs (and therefore inputs to the Trip End Model) are described in the below sections.</p>"},{"location":"02_methodology.html#population-data","title":"Population Data","text":"<p>These files have the file naming convention of <code>tmfs{model\u00a0year}{test\u00a0id}.CSV</code>.  These files contain the population data for each zone separated by eight  household types and nine person types (note that the data excludes separate  student population columns, as students are included in the \"Non-Working\" section). Within the Trip End Model, the student data set is extracted from the non-working column using a set of factors, which are 0.2794 for Males and 0.2453 for Females2. Once the student data is separated, this generates the full 88 person type categories as described previously.</p> <p>An option has been added to the Trip End Model to allow population data to be used that splits full-time and part-time workers into 2 categories, Working at Home and Working by Commute. This brings the number of fields in the population data shown in the below image from 11 up to 15 (including zone and household type). If this format of population is being used, the <code>TripRatesSplit.csv</code> file must be supplied, providing trip rates for each working location segment - see previous section \"National Trip End Model (NTEM)\" for details. If the population data is being provided using this split, the suffix <code>_hw</code> (indicating home-working splits) should be added to the file name for version control, e.g. instead of <code>tmfs18XX.csv</code>, the file name would be <code>tmfs18XX_hw.csv</code>.</p> <p></p>"},{"location":"02_methodology.html#households-and-employment-data","title":"Households and Employment Data","text":"<p>These files have the file naming convention of <code>tav\\_{model\u00a0year}{test id}.CSV</code>.  These data files contain the total number of household and employment (jobs) for each modelled zone. Employment data is further separated by employment type, including agriculture and fishing, retail, hospitality, local financial, education and health and social services. These separate employment types allow the use of different trip attraction ratios within the Trip End Model. It should be noted that the included employment categories are not comprehensive and, therefore, do not equal the total employment figures.</p> <p></p>"},{"location":"02_methodology.html#goods-vehicle-data","title":"Goods Vehicle Data","text":"<p>These files have the file naming convention of <code>trfl{model\u00a0year}{test\u00a0id}.DAT</code>.  These files represent a matrix of travel movements set out within a flat file  format. The file contains four columns which represent:</p> <ul> <li>vehicle type (1=LGV, 2=OGV),</li> <li>origin zone, </li> <li>destination zone, and </li> <li>vehicle flow.</li> </ul> <p>Note that within the file naming convention, \"model year\" refers to the relevant base or forecast modelled year scenario. \"Test id\" represents the TELMoS model test ID code.</p> <p></p>"},{"location":"02_methodology.html#external-traffic-movements","title":"External Traffic Movements","text":"<p>DfT Road Traffic Forecast (RTF) data is used to create the future growth in road travel movements for cars between the external areas of TMfS (i.e. areas outside of Scotland). This includes external to external trips, external to internal and vice-versa.</p> <p>The 2018 RTF factors are shown below. They represent RTF Scenario 1 (Reference) for England and Wales3, which are rebased to 2015 and interpolated for LATIS forecast years between the RTF 5-year intervals (2015, 2020, 2025 etc up to 2050).</p> Year Car 2015 1.00 2018 1.04 2022 1.09 2027 1.14 2032 1.19 2037 1.23 2042 1.28 <p>These growth factors are applied within a gravity model to forecast changes in external travel movements over time. The base year external trip ends (including external to internal and vice versa) are factored using these growth values to create forecast year external trip ends. These forecast trip ends are then applied to a gravity model (in tandem with the base year matrices) to create forecast year external matrices.</p> <p>The gravity model effectively applies a smoothing process to reduce the level of inappropriate large cell-to-cell movements within these matrices. A similar process is applied during the development of the base year external travel demand.</p>"},{"location":"02_methodology.html#external-rail-movements","title":"External Rail Movements","text":"<p>Factors associated with external rail trips are factored separately to those of road traffic. The growth factors for rail trips are based on</p> <ul> <li>forecast Scotland Gross Value Added (GVA) data from TELMoS; and</li> <li>rail demand elasticity from the Passenger Demand Forecasting     Handbook (PDFH) version 6.</li> </ul> <p>To calculate the growth factors, the GVA growth was adjusted by an elasticity of 1.1 from PDFH6 Table B2.3b, representing an elasticity between the values for Non-London \"between core cities\" (1.25) and \"Other\" (1.0). These growth factors are shown below for the key LATIS forecast years.</p> Year Rail Demand Growth 2018 1.000 2022 1.047 2027 1.134 2032 1.223 2037 1.306 2042 1.391"},{"location":"02_methodology.html#airport-related-travel-forecasts-growth-data","title":"Airport Related Travel Forecasts Growth Data","text":"<p>Surface access to Scottish Airports by car and public transport is included within TMfS. The airport zones included in TMfS18 are displayed below.</p> Airport Zone Edinburgh Airport 709 Prestwick Airport 710 Glasgow Airport 711 Aberdeen Airport 712 <p>The growth factors for the airport zones are provided to the Trip End Model in the <code>airport_factors.csv</code> file within the \"Factors\" folder.</p> <p>Potential future changes to these types of travel movement can be calculated using the UK Aviation Forecasts 2017 from the DfT4, which present forecast passenger figures for UK airports from 2016 to 2050, and have been used to prepare a set of growth factors.</p> <p>The percentage annual growth for airport-related trips is applied consistently to all car and public transport trip purposes.</p>"},{"location":"02_methodology.html#model-application","title":"Model Application","text":""},{"location":"02_methodology.html#car-and-public-transport-trip-productions","title":"Car and Public Transport Trip Productions","text":"<p>Synthesised trip production vectors are created for the model base year (pivot year) and each forecast year scenario by multiplying the trip rates (calculated from NTEM) with the population planning data (output from TELMoS). This forms a set of zone-based vectors for each travel mode, purpose and person type for each year.</p> <p>The synthesised forecast year vectors are then divided by the synthesised base year vectors to prepare growth factors. These growth factors are then applied to the calibrated TMfS18 base year trip ends to prepare forecast year trip ends for input to the demand model. This process can be described as:</p> \\[P_{m,t,p}^{f} = \\ P_{m,t,p}^{b}\\ \\frac{NTEM_{m,t,p}^{f}}{NTEM_{m,t,p}^{b}}\\] <p>where:</p> <ul> <li>\\(P_{m,t,p}^{f}\\) represents forecast year person trip productions by mode/Car   availability <code>m</code>, time period <code>t</code>, and journey purpose <code>p</code></li> <li>\\(P_{m,t,p}^{b}\\) represents base year person trip productions by mode/Car   availability <code>m</code>, time period <code>t</code>, and journey purpose <code>p</code></li> <li>\\(NTEM_{m,t,p}^{f}\\) represents forecast year person trip productions by   mode/Car availability <code>m</code>, time period <code>t</code>, and journey purpose <code>p</code>,   produced by NTEM model trip rates</li> <li>\\(NTEM_{m,t,p}^{b}\\) represents base year person trip productions by mode/Car   availability <code>m</code>, time period <code>t</code>, and journey purpose <code>p</code>, produced by NTEM   trip rates</li> </ul> <p>Initially, trip ends are generated for eight home-based journey purposes, of which commute, employers-business and education trips are applied directly within the TMfS demand model. The remaining five purposes (shopping, personal business, recreation, visiting and holiday) are combined to form the home-based other trip purpose, which is also applied within the TMfS demand model.</p> <p>Each journey purpose is then separated into the following car ownership segments for input to the TMfS demand model:</p> <ul> <li>persons from non-car owning households;</li> <li>persons from single car owning households with 1 adult;</li> <li>persons from single car owning households with 2+ adults; and</li> <li>persons from multi car owning households.</li> </ul> <p>The Morning Peak, Inter Peak and Evening Peak time periods in NTEM are directly compatible with the TMfS time periods.</p> <p>Note that the process above is used to generate trip productions for from-home trip purposes for inclusion to the TMfS demand model. To-home trips and non-homebased trip ends are created using a separate process (based on these trip productions) within the demand model.</p>"},{"location":"02_methodology.html#trip-attractions-and-attraction-factors","title":"Trip Attractions and Attraction Factors","text":"<p>The trip attraction process is a parallel procedure undertaken in tandem with preparing trip productions. The Trip End Model includes separate trip attractions for each journey purpose and time period. However, attractions are in a more aggregate form with all household/car ownership segments and travel modes combined.</p>"},{"location":"02_methodology.html#trip-attractions-within-the-demand-model","title":"Trip Attractions within the Demand Model","text":"<p>Within the demand model trip attractions fall into two distinct categories:</p> <ul> <li>Trip attractions for home-based work (commute) which is a doubly   constrained travel purpose in the destination choice model; and</li> <li>Trip attraction factors for home-based employer's business and   home-based other, which are singly constrained travel purposes in   the destination choice model.</li> </ul> <p>Home-based work attractions represent actual trip attractions and act as constraints within the destination choice process.</p> <p>For the Home-based Employer's Business and Home-Based Other purposes, however, attraction factors (attraction weightings) are applied. These are used in tandem with generalised costs to distribute trips across destinations. Therefore, there are no constraints for the actual trip attractions to equal the attraction factors for each zone. This process represents the specific HBE and HBO travel purposes which are singularly constrained within the demand model.</p> <p>The attraction factors for the base-year were calculated using an iterative process. This involved successively adjusting attraction factors and applying the singly constrained model until the resulting actual trip attractions best matched those within the base matrices (used in the destination choice model calibration).</p>"},{"location":"02_methodology.html#attraction-factors","title":"Attraction Factors","text":"<p>The trip attraction factors applied in the Trip End Model are described in the file <code>Attraction Factors.txt</code> in the \"Factors\" folder. The attraction factors represent the relationship between different trip purposes and different land use types. These data illustrate the number of trips attracted to each type of job per week. For example, there are (on average) 4,348 trips to school for each job in education.</p> <p>The attraction factors, similar to the production trip rates, are applied to the planning data for both the base (pivot) year and forecast year scenarios. The resultant (synthesised) trip end vectors are then used to produce growth factors, which are applied to the calibrated TMfS trip end attractions. Consistent attraction growth factors are used for all travel modes for each travel purpose.</p> <p>Note that these factors are not applied to produce actual levels of trip attractions. They are used to represent sectors that have different factors, and as a result provide different attraction weightings for the various land use types on a zonal basis.</p> <p>Within the Trip End Model, the total level of trip productions is used as a constraint to ensure that the total level of trip attractions match total productions.</p>"},{"location":"02_methodology.html#goods-vehicles","title":"Goods Vehicles","text":"<p>Goods vehicle trips are not subject to the core TMfS Demand Model processes. Changes in goods vehicle trips over time are created within a separate process. This applies a combination of TMfS base year goods vehicles matrices and goods vehicle data extracted from the commodity model within TELMoS. The resultant goods vehicle matrices are prepared independently of the Demand Model for each future year and economic growth scenario.</p> <p>The base year goods vehicle matrices (formatted in Passenger Car Units - PCUs) are described for each modelled hour (AM Peak, Inter\u00a0Peak and PM Peak) and by vehicle type, (LGV and HGV). The forecasting process applied to these base matrices has the following four steps:</p> <ol> <li>Calculate forecast year percentage growth on a trip end basis    between TELMoS base year and forecast year matrices (these matrices    cover internal goods vehicle movements within the TMfS modelled    area);</li> <li>Apply this percentage growth to the TMfS base year goods vehicle    trip ends;</li> <li>Apply NRTF growth to external zones; and</li> <li>Input these trip ends, along with the base year matrices through a    gravity model to produce smoothed forecast year matrices.</li> </ol> <p>This process is applied to all TMfS18 goods vehicle trips including cross-border movements.</p>"},{"location":"02_methodology.html#education-matrices","title":"Education Matrices","text":"<p>The education travel matrices included within TMfS18 are input post the main demand model stage. Within the Trip End Model, education-based trip end files are created using a consistent process as applied for other travel purposes. The forecast year education matrices are then created by using these synthesised trip ends and the (calibrated) base (pivot) year education matrices within a gravity model.</p> <ol> <li> <p>CTRIPEND User Manual, Department for Transport, 2016.\u00a0\u21a9</p> </li> <li> <p>These factors were generated using population data from TELMoS\u00a0\u21a9</p> </li> <li> <p>Road Traffic Forecasts 2018, Department for Transport\u00a0\u21a9</p> </li> <li> <p>UK aviation forecasts 2017, Department for Transport\u00a0\u21a9</p> </li> </ol>"},{"location":"03_user_guide.html","title":"User Guide","text":""},{"location":"03_user_guide.html#overview","title":"Overview","text":"<p>The following sections describe how to operate the Trip End Model and the relevant model directory structures.</p>"},{"location":"03_user_guide.html#input-data-and-directory-structure","title":"Input Data and Directory Structure","text":"<p>To generate new demands for use in TMfS, three distinct folders structures are  required. The first is used to store the TMfS demands themselves and the second  to store the files as provided from TELMoS. These, respectively, are referred  to as <code>tmfs_root</code> and <code>delta_root</code> in this guide. The third folder is used to  store the Factors files used by the trip-end model.</p>"},{"location":"03_user_guide.html#tmfs_root","title":"<code>tmfs_root</code>","text":"<p>The Trip End Model files are located within various folders under a main TMfS model directory. The PC will also need to have the correct version of Cube  installed - this should be the same version used to run TMfS itself.</p> <p>As the Trip End Model is an incremental model, it needs to pivot from the existing run of the base year model and/or a previous forecast year scenario. As a result, the base year files must exist on the PC running the Trip End Model before a new forecast year run can be undertaken. Therefore, the calibrated base year trip ends should be located in the directory:</p> <pre><code>{tmfs_root}\\Runs\\{base_year}\\Demand\n</code></pre> <p>where <code>base_year</code> for 2018 would be \"18\".</p>"},{"location":"03_user_guide.html#delta_root","title":"<code>delta_root</code>","text":"<p>The Trip End Model uses various planning data and goods vehicle data output from the TELMoS model. For each modelled year, three files are required, including:</p> <ul> <li><code>tav_{tel_year}{tel_scenario}.csv</code> - the household and employment   data file;</li> <li><code>tmfs{tel_year}{tel_scenario}[_hw].csv</code> - the population data   file. The <code>_hw</code> suffix is added if the file is split by WAH/WBC; and</li> <li><code>trfl{tel_year}{tel_scenario}.dat</code> - the goods vehicle data file.   Where <code>tel_year</code> is the forecast year and <code>tel_scenario</code> is the   TELMoS test scenario code, e.g. \"AE\" and \"18\" respectively.</li> </ul> <p>For each new forecast year modelled scenario, a new folder should be created in <code>delta_root</code>, named using the relevant TELMoS scenario code (<code>tel_scenario</code>). The three files should be saved in the folder  <code>{delta_root}\\{tel_scenario}</code>.</p>"},{"location":"03_user_guide.html#factors","title":"Factors","text":"<p>The remaining input data is contained within the \"Factors\" directory. The files in this folder contain the trip rates and attraction factors described previously. By default, this is assumed to be contained within  <code>tmfs_root</code>, i.e. <code>{tmfs_root}\\Factors</code>.</p>"},{"location":"03_user_guide.html#setting-up-the-model-run","title":"Setting up the Model Run","text":"<p>If no previous model run of the Trip End Model has been undertaken for a forecast year, a new folder should be created in <code>{tmfs_root}\\Runs\\{tel_year}\\{tel_scenario}</code>. Within this folder, a further folder named \"Demand\" should also be created.</p>"},{"location":"03_user_guide.html#required-inputs","title":"Required Inputs","text":"<p>Now the directory structure is complete the model executable can be run. This can be undertaken either using the executable GUI or through the command line - via a batch file or other method. The executable has  eight required arguments, as follows:</p> <ul> <li>Delta Root - path for the DELTA files;</li> <li>TMfS Root - path for the executable;</li> <li>Forecast Year - 2-digit year;</li> <li>Forecast TMfS Scenario - what the user is calling the demand   scenario which is produced by this run of the Trip End Model;</li> <li>Forecast Year TELMoS scenario code;</li> <li>Base Year - the year used to pivot from</li> <li>Base TMfS Scenario Code - the demand model input set that is being   pivoted from; and</li> <li>Base Year TELMoS Scenario Code - the planning data used to create   the base scenario</li> </ul>"},{"location":"03_user_guide.html#optional-inputs","title":"Optional Inputs","text":"<p>In addition to the required inputs, there are a series of optional inputs which may need to be filled in depending on the scenario you are running. </p> <ul> <li>Integrate Home Working - if selected, the population data and trip rate data    will be expected with the WAH/WBC split discussed in the    \"TELMoS Planning Data\" section. Checked on by default;</li> <li>Use Old Trip Rate Format - Can be selected to use the previous format of    production trip rates (separate files for each segmentation containing a    matrix of trip rates by household/person type). Unchecked by default; and</li> <li>Trip Rate File/RTF/PTF/Airport Factors File - Alternative location for factor    files. If blank, this assumes the files can be found in <code>{tmfs_root}\\Factors</code>   with their default names.</li> </ul>"},{"location":"03_user_guide.html#running-the-trip-end-model","title":"Running the Trip-End Model","text":"<p>Once the arguments have been entered, the model can be run. A model run should typically take less than 5 minutes to complete for one scenario.</p>"},{"location":"03_user_guide.html#trip-end-outputs","title":"Trip End Outputs","text":"<p>A successful Trip End Model run will create the following output files:</p> <ul> <li><code>*.TOD</code> / <code>*.CTE</code> files - nine of each, these are the trip end files for   input to the demand model;</li> <li><code>tav_{tel_year}_{tel_scenario}.csv</code>,   <code>tmfs{tel_year}_{tel_scenario}.csv</code>, <code>lgv{tel_year}{tel_scenario}.dat</code> and   <code>hgv{tel_year}{tel_scenario}.dat</code> - these are the files which are used for    future pivoting; and</li> <li><code>*.DAT</code> and <code>*TE.DAT</code> - 36 files, these are files for each goods   vehicle and add-in category for each time period.</li> </ul> <p>The folder structure containing the various output files is shown below.  The content of these folders are used to create trip ends for each subsequent year. The base year can also be used to provide the pivoting year to create subsequent forecast year data.</p> <p></p>"},{"location":"03_user_guide.html#output-trip-end-files","title":"Output Trip End Files","text":""},{"location":"03_user_guide.html#example-tod-file","title":"Example TOD File","text":"<p>The <code>*.TOD</code> file contains six columns, including:</p> <ul> <li>Modelled zone;</li> <li>C11 Productions (1 Car 1 Adult Household);</li> <li>C12 Productions (1 Car 2+ Adult Household);</li> <li>C2 Productions (2+ Car Households);</li> <li>C0 Productions (0 Car Households); and</li> <li>all trip attractions (in person-trips).</li> </ul> <p></p>"},{"location":"03_user_guide.html#example-cte-file","title":"Example CTE File","text":"<p>The <code>*.CTE</code> file contains similar information with the exception that columns are disaggregated by car and public transport. The columns for the CTE file include:</p> <ul> <li>Modelled zone;</li> <li>Car - C11C Productions (1 Car 1 Adult Household);</li> <li>Car - C12C Productions (1 Car 2+ Adult Household);</li> <li>Car - C2C Productions (2+ Car Households);</li> <li>PT - C11P Productions (1 Car 1 Adult Household);</li> <li>PT - C12P Productions (1 Car 2+ Adult Household);</li> <li>PT - C2P Productions (2+ Car Households);</li> <li>PT - C0 Productions (0 Car Households); and</li> <li>all trip attractions (in person-trips).</li> </ul> <p></p> <p>Note: In the <code>*.CTE</code> file the split between car and PT is taken from the pivot year. The CTE splits are used to start the demand model and the mode choice model then applies.</p>"},{"location":"03_user_guide.html#pivoting-files","title":"Pivoting Files","text":"<p>Examples of the <code>tav_XX_SS.csv</code> and <code>tmfsXX_SS.csv</code> files are shown in figures below. These are used in future year pivoting.</p> <p>The TAV file contains the relevant planning data file multiplied by the trip attraction rates and then combined into Work (HW), Employers Business (HE), Other (HO) and Education (HS) purposes. This data is then used in conjunction with a similar file from a forecast year to produce attraction growth factors. In this case the factors are the same for all time periods, modes and household types.</p> <p></p> <p>Similarly, the <code>tmfsXX_SS.csv</code> file contains the relevant planning data multiplied by the trip rates described in section \"Trip Rate Calculation\". It is used in conjunction with a file for a future year scenario to produce production growth factors. Different values are produced by time period, mode and household type. These are designated in the column headers by A, I and P for the time periods; C11, C12, C2 and C0 for the household types; C and P for car and PT and W, E, O and S (Work, Employers Business, Other and Education) for the purposes.</p> <p></p>"},{"location":"03_user_guide.html#goods-vehicle-files","title":"Goods Vehicle Files","text":"<p>For goods vehicles, <code>*.DAT</code>:</p> <p></p> <p>and <code>*TE.DAT</code> files:</p> <p></p> <p>are produced for input to the smoothing process.</p> <p>The <code>hgv{tel_year}{tel_scenario}.dat</code> (and  <code>lgv{tel_year}{tel_scenario}.dat</code>) files are also generated:</p> <p></p> <p>These are the TELMoS-based goods vehicle matrices. These are used with their equivalent file from a forecast year scenario to produce goods vehicle growth factors.</p>"},{"location":"03_user_guide.html#new-base-year-planning-data","title":"New Base Year Planning Data","text":"<p>If new base year (2018) land use planning data is produced, this should be run through the Trip End Model to create new <code>tav_{tel_year}_{tel_scenario}.csv</code>, <code>tmfs{tel_year}_{tel_scenario}.csv</code>, <code>lgv{tel_year}{tel_scenario}.dat</code> and <code>hgv{tel_year}{tel_scenario}.dat</code> files. These new data would then be applied to calculate new forecast year growth factors. This process requires the following steps:</p> <ul> <li>Create a dummy base year folder (e.g. 14);</li> <li>Copy the contents of the current \"18\" folder into this dummy folder;</li> <li>Run the Trip End Model with \"14\" as the base year and \"18\" as the   forecast year, linking to the new \"18\" planning data into the \"18\"   folder; and</li> <li>It is likely that the new base year trip ends will not be completely   identical to the calibrated and validated base year trip ends, so   finally the user needs to copy the original base year <code>*.TOD</code> and   <code>*.CTE</code> files into the new Base year scenario folder.</li> </ul> <p>In other words, the only new files which are required are the <code>tmfs18_AXX.csv</code> and <code>tav_18_AXX.csv</code> files.</p>"},{"location":"03_user_guide.html#additional-processing","title":"Additional Processing","text":"<p>The outputs generated by the trip-end model need some additional processing to provide the full set of files required by TMfS.</p>"},{"location":"03_user_guide.html#add-ins-and-smoothing","title":"Add-Ins and Smoothing","text":"<p>The \"Add-in\" process represents the calculation of travel movements that are not contained in the core TMfS demand model. This includes a \"smoothing\" stage which represents a gravity model process. These stages are associated with forecasting goods vehicles, external trips and education matrices.</p> <p>The processing application required for these steps is not included as part  of this repository. Typically the trip-end model is only run by the current TMfS developer, however users who feel they may require this application should fill  out a LATIS request form.</p> <p>To undertake this process, a model user should open the <code>Smoothing.cat</code> CUBE file - ideally, this should be located at <code>{tmfs_root}\\Smoothing</code>.  On opening the file, a CUBE Catalog will be opened, as shown below:</p> <p></p> <p>In the Scenarios section of the catalogue, right click on <code>Base</code>, select <code>Add Child</code> and name using the forecast scenario ID and forecast year (e.g. \"AJA_31\"). In the pop-up box enter the required details e.g. Base Year, Base Scenario, Forecast Year, Forecast Scenario. If the base year is 2018 enter \"18\". In the \"FileBaseYear\" box enter the base year. If this is 2018 enter \"18\". Once all details have been entered select \"Run\".</p> <p>The smoothing process then automatically links to the files in the \"demand\" folder produced by the previous part of the Trip End Model and runs to produce the \"add-in\" files - goods vehicle, external trips and education matrices. This process in operation is shown below. It takes around 20 minutes to complete one forecast year.</p> <p></p> <p>The Smoothing process produces three education matrices in the <code>demand\\{tel_scenario}</code> folder (one for each time period), and six add-in matrices; HGV, LGV, COM (Home Based Work), EMP (Home Based Employers Business), OTH (Home Based Other) and PT in the same folder.</p> <p>Once all files have been produced (<code>*.TOD</code>, <code>*.CTE</code>, Education matrices and Add-in matrices) these are then the input demand files.</p> <p>These demand scenario files should be transferred manually into the relevant folder for undertaking demand model runs. This should be <code>{tmfs_root}\\Runs\\{tel_year}\\Demand\\{tel_scenario}</code>.</p>"},{"location":"03_user_guide.html#additional-files-required-by-tmfs","title":"Additional files required by TMfS","text":"<p>There are a series of additional files required by TMfS which are not generated by the trip-end model. These files are assumed to not change from the base  scenario, and as such the standard approach is to copy these files in from an  existing (\"known\") scenario to the current scenario's directory. The filename patterns for these files are:</p> <ul> <li><code>*.gcm</code></li> <li><code>*sov*.mat</code></li> <li><code>*add_h*.mat</code></li> <li><code>*.msp</code></li> <li><code>parking_charge.mat</code></li> <li><code>AM_*z_00.prp</code></li> </ul>"},{"location":"03_user_guide.html#checking-the-demand-folder","title":"Checking the demand folder","text":"<p>Following each of these steps, the demand folder should contain 76 files in total. If there are fewer files than this, there is likely something missing that may cause TMfS to crash.</p>"},{"location":"04_io.html","title":"Input and Output Files","text":""},{"location":"04_io.html#overview","title":"Overview","text":"<p>This section describes the input and output files used in the Trip End Model process. The files are described in sets depending on the containing folder.</p>"},{"location":"04_io.html#input-files","title":"Input Files","text":"<p>The following are input files associated with the Trip End Model.</p>"},{"location":"04_io.html#trip-end-folder","title":"Trip End Folder","text":"<ul> <li><code>TELMoS_script.py</code> - this is the file that can be run from   command-line or other scripting method if batches of runs need to be   executed; and</li> <li><code>gui.py</code> - the GUI version of the Trip End Model.</li> </ul>"},{"location":"04_io.html#delta-folder","title":"Delta Folder","text":"<p>These files should be within a sub-folder within the Delta folder, named after the TELMoS ID:</p> <ul> <li> <p><code>tav_{tel_year}{tel_id}.csv</code> - the household and employment planning   data outputs from the TELMoS model. Contains the following columns:   zn, households, employment, agriculture and fishing, retail,   hospitality, local financial, education and health and social   services;</p> </li> <li> <p><code>tmfs_{tel_year}{tel_id}.csv</code> - the population planning data outputs   from TELMoS, include the columns: Zone, Household, Children,   Full-Time Male Worker, Full-Time Female Worker, Part-Time Male   Worker, Part-Time Female Worker, Non-working male, Non-working   Female, Male Retired and Female Retired; and</p> </li> <li> <p><code>trfl{tel_year}{tel_id}.dat</code> - this contains the good vehicle data   output from the TELMoS commodity model. It contains four columns:   Goods vehicle type, origin zone, destination zone and value</p> </li> </ul>"},{"location":"04_io.html#factors-folder","title":"Factors Folder","text":"<ul> <li><code>RTF.dat</code> - contains the default Road Traffic Forecast growth   factors;</li> <li><code>PTF.dat</code> - contains the default Public Transport Forecast growth   factors;</li> <li><code>Attraction Factors.txt</code> - Contains the attraction trip rates;</li> <li><code>airport_factors.csv</code> - contains the default growth factors for each   airport zone, available from 2017 to 2050;</li> <li><code>TripRates.csv</code> - contains the trip rates used to create synthetic     productions. Columns required are (in order):<ul> <li>purpose - HBE, HBW, HBO, HBS;</li> <li>mode - Car, PT;</li> <li>period - AM, IP, (PM, OP optional);</li> <li>area - 3, 4, 5, 6, 7, 8;</li> <li>work_type - WAH, WBC - (optional: only required in <code>TripRatesSplit.csv</code>);</li> <li>traveller_type - 1 - 88;</li> <li>trip_rate - The trip rate for this segmentation (by default   rounded to 3 decimal places); and</li> <li>tt_desc - (optional: description of the traveller type)</li> </ul> </li> </ul>"},{"location":"04_io.html#output-files","title":"Output Files","text":"<p>The following are the output files from the TMfS18 Trip End Model. The location and examples of the main files are described in Section 3. The examples below are for a model run that has the TELMoS year set as 18 and the TELMoS scenario as AAL.</p>"},{"location":"04_io.html#telmos-output-files","title":"TELMoS Output Files","text":"<ul> <li><code>tav_18_AAL.csv</code> - The attraction trip rates multiplied by the   planning data vectors for this scenario, used in future pivoting;</li> <li><code>tmfs18_AAL.csv</code> - The production trip rates multiplied by the   planning data vectors for this scenario, used in future pivoting;</li> <li><code>{period}_{purpose}_D0.CTE</code> - The trip end files (with car and PT   splits) - one file for each purpose (HBE, HBW, HBO, HBE) and each   time period (AM, IP, PM);</li> <li><code>{period}{purpose}.DAT</code> - The forecast matrix pre-external smoothing, where:<ul> <li>period is one of AM, IP, PM </li> <li>purpose is one of COM, OTH, EMP, HGV, LGV, PT;</li> </ul> </li> <li><code>{period}{purpose}TE.DAT</code> - The external trip ends for use in the   smoothing process - period is one of AM, IP, PM and purpose is one   of COM, OTH, EMP, HGV, LGV, PT;</li> <li><code>{purpose}_ADD_18AAL.MAT</code> - The add-in matrices for this year and   scenario, contain one table for each time period - purpose is one   of NWC, NOW, IW, HGV, LGV, PT; and</li> <li><code>{period}_HS_18AAL.MAT</code> - The forecast education matrix, the tables   in the matrix are: C11C, C12C, C2C, C11P, C12P, C2P, C0P - period   is one of AM, IP, PM.</li> </ul>"},{"location":"04_io.html#other-data-files","title":"Other Data Files","text":"<p>There are a number of other files associated with the Trip End Model. Firstly, there are the files associated with building the executable file.</p> <p>Secondly there are a number of files associated with the CUBE catalog smoothing process. This manual has described the relevant use of these files but does not provide further detail as most of these files are generated automatically by CUBE.</p>"},{"location":"05_programming_overview.html","title":"Programming Overview","text":""},{"location":"05_programming_overview.html#overview","title":"Overview","text":"<p>The main component of the TMfS18 Trip End Model is coded in Python. This section describes the coding of the program in Python.</p> <p>The Trip End Model was coded in Python version 3.7.5 and any updates or amendments to the software should be undertaken using this, or a later a version of the software.</p>"},{"location":"05_programming_overview.html#coding","title":"Coding","text":"<p>The main function of the Python files are as follows:</p> <ul> <li><code>TELMoS_main.py</code> - replaces the \"main\" sub-routine in the TMfS14 VB   code which calculates the new TMfS trip ends. The methodology is as   follows:<ul> <li>Read in all \"Factors\" and \"Delta\" files to the expected format;</li> <li>Calculate attraction factors and attraction growth factors;</li> <li>Calculate production factors and production growth factors;</li> <li>Read in the pivot year TMfS calibrated trip ends (<code>*.CTE</code> and <code>*.TOD</code>);</li> <li>Add in the airport growth;</li> <li>Combine the NTEM purposes to TMfS purposes; and</li> <li>Create and write out the new TMfS trip ends (<code>*.CTE</code> and <code>*.TOD</code>).</li> </ul> </li> <li><code>TELMoS_goods.py</code> - replaces the \"goods\" sub-routine in the TMfS14 VB   code which calculates the new trip ends for goods vehicles. The   methodology is as follows:<ul> <li>Read in the goods \"Delta\" files;</li> <li>Read in the pivot year goods matrices;</li> <li>Create forecast commodity matrices; and</li> <li>Create and write forecast TMfS goods vehicle trip end files.</li> </ul> </li> <li><code>TELMoS_addins.py</code> - replaces the \"addins\" sub-routine in the TMfS14   VB code which calculates the new trip ends for external zones. The   methodology is as follows:<ul> <li>Read in the pivot year add-in matrices;</li> <li>Read in and apply the NRTF factors; and</li> <li>Create and write forecast TMfS add in trip end files.</li> </ul> </li> <li><code>TELMoS_script.py</code> - is the script that can be run from command-line   for a full run of each part of the Trip End Model;</li> <li><code>gui.py</code> and <code>widget_templates.py</code> - creates a graphical user interface   to enter the arguments for the Trip End Model and show a log of the   process; and</li> <li><code>data_functions.py</code> - other functions used in the process.</li> </ul>"},{"location":"05_programming_overview.html#graphical-user-interface","title":"Graphical User Interface","text":"<p>The GUI in-use will look similar to the following: </p> <p>Options that have not been discussed in the previous sections include:</p> <ul> <li>Export/Import Settings - allows the user to save and load all   settings in the GUI;</li> <li>Check for Newer Releases - opens the GitHub repository for the Trip   End Model.</li> </ul>"}]}